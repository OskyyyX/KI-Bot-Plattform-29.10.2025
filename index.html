<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KI-Bot Platform - Admin Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <!-- Google API Client Library -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <img src="logo.png" alt="KI-Bot Logo" class="logo" onerror="this.style.display='none'">
                <h2>KI-Bot Platform</h2>
            </div>
            <ul class="nav-links">
                <li data-page="dashboard">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </li>
                <li class="active" data-page="bots">
                    <i class="fas fa-robot"></i>
                    <span>Meine Bots</span>
                </li>
                <li data-page="config">
                    <i class="fas fa-cogs"></i>
                    <span>Konfiguration</span>
                </li>
                <li data-page="analytics">
                    <i class="fas fa-chart-bar"></i>
                    <span>Analytik</span>
                </li>
                <li data-page="billing">
                    <i class="fas fa-credit-card"></i>
                    <span>Abrechnung</span>
                </li>
            </ul>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Dashboard Page -->
            <div class="page" id="dashboard">
                <header class="page-header">
                    <h1>Dashboard</h1>
                    <div class="user-menu">
                        <span class="user-name">Max Mustermann</span>
                        <img src="avatar.png" alt="User Avatar" class="avatar" onerror="this.style.display='none'">
                    </div>
                </header>

                <div class="dashboard-grid">
                    <div class="stats-card">
                        <h3>Aktive Bots</h3>
                        <p class="stat-number">5</p>
                    </div>
                    <div class="stats-card">
                        <h3>Gespr√§che heute</h3>
                        <p class="stat-number">127</p>
                    </div>
                    <div class="stats-card">
                        <h3>API Aufrufe</h3>
                        <p class="stat-number">1,234</p>
                    </div>
                    <div class="stats-card">
                        <h3>Kosten heute</h3>
                        <p class="stat-number">‚Ç¨2.50</p>
                    </div>
                </div>

                <div class="quick-actions">
                    <button class="btn primary">
                        <i class="fas fa-plus"></i>
                        Neuen Bot erstellen
                    </button>
                    <button class="btn secondary">
                        <i class="fas fa-upload"></i>
                        Daten importieren
                    </button>
                </div>
            </div>

            <!-- Bot Configuration Page -->
            <div class="page active" id="bots">
                <header class="page-header">
                    <h1>Bot-Konfiguration</h1>
                </header>
                
                <div class="bot-list">
                    <!-- Website Bot Card -->
                    <div class="bot-card">
                        <div class="bot-header">
                            <h3>Website Bot</h3>
                            <label class="switch">
                                <input type="checkbox" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="bot-settings">
                            <div class="setting-group">
                                <label>Mistral AI API-Konfiguration</label>
                                <div class="api-config">
                                    <div class="api-key-input">
                                        <label>Mistral API-Schl√ºssel</label>
                                        <div class="input-with-validation">
                                            <input type="password" id="apiKeyInput" placeholder="Geben Sie Ihren Mistral AI API-Schl√ºssel ein..." class="api-key-field">
                                            <button class="btn secondary" onclick="saveApiKey()">
                                                <i class="fas fa-save"></i> Speichern
                                            </button>
                                            <button class="btn secondary validate-api-btn" onclick="validateApiKey()">
                                                <i class="fas fa-check"></i> Validieren
                                            </button>
                                        </div>
                                        <div class="api-status" id="websiteApiStatus"></div>
                                    </div>
                                    
                                    <div class="model-selection">
                                        <label>Mistral AI Modell</label>
                                        <select id="modelSelect" class="model-select">
                                            <optgroup label="Mistral Modelle">
                                                <option value="mistral-large-latest">Mistral Large (neueste Version)</option>
                                                <option value="mistral-medium-latest">Mistral Medium</option>
                                                <option value="mistral-small-latest">Mistral Small</option>
                                                <option value="open-mistral-7b">Open Mistral 7B</option>
                                                <option value="open-mixtral-8x7b">Open Mixtral 8x7B</option>
                                                <option value="open-mixtral-8x22b">Open Mixtral 8x22B</option>
                                            </optgroup>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="setting-group">
                                <label>ü§ñ Agent-Funktionen (API-Verbindungen)</label>
                                <div class="info-hint">
                                    <p style="margin: 0; font-size: 0.875rem; color: #e65100;">
                                        üöÄ <strong>NEU:</strong> Der Bot kann als intelligenter Agent handeln und Aktionen ausf√ºhren (z.B. Termine buchen, E-Mails senden).
                                    </p>
                                </div>
                                <div class="agent-config">
                                    <!-- Container f√ºr hinzugef√ºgte APIs -->
                                    <div id="websiteApiList" class="api-list"></div>
                                    
                                    <!-- + API hinzuf√ºgen Button -->
                                    <div class="add-api-box" onclick="openApiModal('website')">
                                        <i class="fas fa-plus-circle"></i>
                                        <span>API hinzuf√ºgen</span>
                                    </div>
                                </div>
                            </div>

                            <div class="setting-group">
                                <label>Bot-Pers√∂nlichkeit & Verhalten</label>
                                <div class="info-hint" style="background: #e3f2fd; border-left-color: #2196f3;">
                                    <p style="margin: 0; font-size: 0.875rem; color: #1565c0;">
                                        üí° <strong>Tipp:</strong> Beschreiben Sie hier in einfachen S√§tzen, wie sich Ihr Bot verhalten soll.
                                    </p>
                                </div>
                                <div class="bot-personality">
                                    <div class="personality-templates">
                                        <button class="btn secondary" style="font-size: 0.8rem; padding: 0.5rem 1rem;" onclick="loadPersonalityTemplate('website', 'professional')">
                                            üëî Professionell
                                        </button>
                                        <button class="btn secondary" style="font-size: 0.8rem; padding: 0.5rem 1rem;" onclick="loadPersonalityTemplate('website', 'friendly')">
                                            üòä Freundlich
                                        </button>
                                        <button class="btn secondary" style="font-size: 0.8rem; padding: 0.5rem 1rem;" onclick="loadPersonalityTemplate('website', 'technical')">
                                            üîß Technisch
                                        </button>
                                        <button class="btn secondary" style="font-size: 0.8rem; padding: 0.5rem 1rem;" onclick="loadPersonalityTemplate('website', 'sales')">
                                            üíº Verkauf
                                        </button>
                                    </div>
                                    <textarea id="websiteBotPersonality" class="personality-input" placeholder="Beschreibe hier in eigenen Worten, wie sich der Bot verhalten soll..."></textarea>
                                    <button class="btn primary" style="margin-top: 10px;" onclick="saveBotPersonality('website')">
                                        <i class="fas fa-save"></i> Pers√∂nlichkeit speichern
                                    </button>
                                </div>
                            </div>

                            <div class="setting-group">
                                <label>Bot testen (Chat)</label>
                                <div class="chat-config">
                                    <div class="chat-window">
                                        <div id="websiteFileContext" class="file-context-banner" style="display: none;"></div>
                                        <div class="chat-messages" id="websiteBotChat"></div>
                                        <div class="chat-input">
                                            <textarea placeholder="Teste deinen Bot hier..." id="websiteBotPrompt"></textarea>
                                            <button class="btn primary" onclick="sendBotInstruction('website')">
                                                <i class="fas fa-paper-plane"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="setting-group">
                                <label>Wissensbasis</label>
                                <div class="knowledge-base">
                                    <div class="file-section">
                                        <h4>Dokumente & Dateien</h4>
                                        <div class="file-upload-container">
                                            <div class="file-upload-box" id="websiteUploadBox">
                                                <i class="fas fa-cloud-upload-alt"></i>
                                                <p>Dateien hier ablegen oder klicken zum Hochladen</p>
                                                <span class="file-types">Unterst√ºtzte Formate: PDF, Word, Excel, CSV, TXT, JSON, XML, etc.</span>
                                                <input type="file" id="websiteFileUpload" multiple accept=".pdf,.doc,.docx,.xlsx,.csv,.txt,.json,.xml">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="uploaded-files">
                                        <h4>Hochgeladene Dateien</h4>
                                        <div class="file-list" id="websiteFileList"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="bot-actions">
                            <button class="btn primary">Speichern & Aktivieren</button>
                        </div>
                    </div>

                    <!-- WhatsApp Bot Card -->
                    <div class="bot-card">
                        <div class="bot-header">
                            <h3>WhatsApp Bot</h3>
                            <label class="switch">
                                <input type="checkbox">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="bot-settings">
                            <div class="setting-group">
                                <label>API-Konfiguration</label>
                                <div class="api-tabs">
                                    <div class="tab-buttons">
                                        <button class="tab-btn active" onclick="switchTab('whatsapp', 'whatsapp')">
                                            <i class="fab fa-whatsapp"></i> WhatsApp
                                        </button>
                                        <button class="tab-btn" onclick="switchTab('whatsapp', 'mistral')">
                                            <i class="fas fa-robot"></i> Mistral AI
                                        </button>
                                    </div>
                                    
                                    <div class="tab-content active" id="whatsappTab">
                                        <div class="whatsapp-config">
                                            <div class="input-group">
                                                <label>Telefonnummer</label>
                                                <input type="tel" placeholder="+49 123 4567890">
                                            </div>
                                            <div class="input-group">
                                                <label>WhatsApp Business API</label>
                                                <input type="text" placeholder="API-Key eingeben">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="tab-content" id="mistralTab">
                                        <div class="mistral-config">
                                            <div class="input-group">
                                                <label>Mistral AI API-Schl√ºssel</label>
                                                <div class="api-input-group">
                                                    <input type="password" id="whatsappMistralKey" placeholder="Geben Sie Ihren Mistral AI API-Schl√ºssel ein..." class="api-key-field">
                                                    <button class="btn secondary validate-api-btn">
                                                        <i class="fas fa-check"></i> Validieren
                                                    </button>
                                                </div>
                                                <div class="api-status" id="whatsappApiStatus"></div>
                                            </div>
                                            
                                            <div class="input-group">
                                                <label>Mistral AI Modell</label>
                                                <div class="model-select-wrapper">
                                                    <select id="whatsappModelSelect" class="model-select">
                                                        <optgroup label="Mistral Modelle">
                                                            <option value="mistral-large-latest">Mistral Large (neueste Version)</option>
                                                            <option value="mistral-medium-latest">Mistral Medium</option>
                                                            <option value="mistral-small-latest">Mistral Small</option>
                                                            <option value="open-mistral-7b">Open Mistral 7B</option>
                                                            <option value="open-mixtral-8x7b">Open Mixtral 8x7B</option>
                                                            <option value="open-mixtral-8x22b">Open Mixtral 8x22B</option>
                                                        </optgroup>
                                                    </select>
                                                    <div class="model-info">
                                                        <i class="fas fa-info-circle"></i>
                                                        <span class="model-tooltip">W√§hlen Sie ein Mistral Modell basierend auf Ihren Anforderungen an Leistung und Kosten.</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="setting-group">
                                <label>ü§ñ Agent-Funktionen (API-Verbindungen)</label>
                                <div class="info-hint">
                                    <p style="margin: 0; font-size: 0.875rem; color: #e65100;">
                                        üöÄ <strong>NEU:</strong> Der WhatsApp-Bot kann als intelligenter Agent handeln und Aktionen ausf√ºhren.
                                    </p>
                                </div>
                                <div class="agent-config">
                                    <!-- Container f√ºr hinzugef√ºgte APIs -->
                                    <div id="whatsappApiList" class="api-list"></div>
                                    
                                    <!-- + API hinzuf√ºgen Button -->
                                    <div class="add-api-box" onclick="openApiModal('whatsapp')">
                                        <i class="fas fa-plus-circle"></i>
                                        <span>API hinzuf√ºgen</span>
                                    </div>
                                </div>
                            </div>

                            <div class="setting-group">
                                <label>Bot-Pers√∂nlichkeit & Verhalten</label>
                                <div class="info-hint" style="background: #e8f5e9; border-left-color: #4caf50;">
                                    <p style="margin: 0; font-size: 0.875rem; color: #2e7d32;">
                                        üí° <strong>Tipp:</strong> Beschreiben Sie hier in einfachen S√§tzen, wie sich Ihr WhatsApp-Bot verhalten soll.
                                    </p>
                                </div>
                                <div class="bot-personality">
                                    <div class="personality-templates">
                                        <button class="btn secondary" style="font-size: 0.8rem; padding: 0.5rem 1rem;" onclick="loadPersonalityTemplate('whatsapp', 'casual')">
                                            üòé Locker
                                        </button>
                                        <button class="btn secondary" style="font-size: 0.8rem; padding: 0.5rem 1rem;" onclick="loadPersonalityTemplate('whatsapp', 'helpful')">
                                            ü§ù Hilfsbereit
                                        </button>
                                        <button class="btn secondary" style="font-size: 0.8rem; padding: 0.5rem 1rem;" onclick="loadPersonalityTemplate('whatsapp', 'fun')">
                                            üéâ Spa√üig
                                        </button>
                                        <button class="btn secondary" style="font-size: 0.8rem; padding: 0.5rem 1rem;" onclick="loadPersonalityTemplate('whatsapp', 'support')">
                                            üí¨ Support
                                        </button>
                                    </div>
                                    <textarea id="whatsappBotPersonality" class="personality-input" placeholder="Beschreibe hier in eigenen Worten, wie sich der WhatsApp-Bot verhalten soll..."></textarea>
                                    <button class="btn primary" style="margin-top: 10px;" onclick="saveBotPersonality('whatsapp')">
                                        <i class="fas fa-save"></i> Pers√∂nlichkeit speichern
                                    </button>
                                </div>
                            </div>

                            <div class="setting-group">
                                <label>Bot testen (Chat)</label>
                                <div class="chat-config">
                                    <div class="chat-window whatsapp-style">
                                        <div id="whatsappFileContext" class="file-context-banner" style="display: none;"></div>
                                        <div class="chat-messages" id="whatsappBotChat"></div>
                                        <div class="chat-input">
                                            <textarea placeholder="Teste deinen WhatsApp-Bot hier..." id="whatsappBotPrompt"></textarea>
                                            <button class="btn primary" onclick="sendBotInstruction('whatsapp')">
                                                <i class="fas fa-paper-plane"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="setting-group">
                                <label>Wissensbasis f√ºr WhatsApp</label>
                                <div class="knowledge-base">
                                    <div class="file-section">
                                        <h4>WhatsApp-Dokumente & Dateien</h4>
                                        <div class="file-upload-container">
                                            <div class="file-upload-box" id="whatsappUploadBox">
                                                <i class="fas fa-cloud-upload-alt"></i>
                                                <p>Dateien hier ablegen oder klicken zum Hochladen</p>
                                                <span class="file-types">Unterst√ºtzte Formate: PDF, Word, Excel, CSV, TXT, JSON, XML, etc.</span>
                                                <input type="file" id="whatsappFileUpload" multiple accept=".pdf,.doc,.docx,.xlsx,.csv,.txt,.json,.xml">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="uploaded-files">
                                        <h4>Hochgeladene Dateien</h4>
                                        <div class="file-list" id="whatsappFileList"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="bot-actions">
                            <button class="btn primary">Speichern & Aktivieren</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal f√ºr Bot-Erstellung -->
    <div class="modal" id="createBotModal">
        <div class="modal-content">
            <h2>Neuen Bot erstellen</h2>
            <form id="createBotForm">
                <div class="form-group">
                    <label>Bot-Name</label>
                    <input type="text" required>
                </div>
                <div class="form-group">
                    <label>Bot-Typ</label>
                    <select required>
                        <option value="website">Website Chat</option>
                        <option value="whatsapp">WhatsApp</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>KI-Modell</label>
                    <select required>
                        <option value="mistral-large">Mistral Large</option>
                        <option value="mistral-medium">Mistral Medium</option>
                        <option value="mistral-small">Mistral Small</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn secondary" onclick="closeModal()">Abbrechen</button>
                    <button type="submit" class="btn primary">Erstellen</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal f√ºr API-Auswahl -->
    <div class="modal" id="apiSelectionModal">
        <div class="modal-content" style="max-width: 700px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 style="margin: 0;">API hinzuf√ºgen</h2>
                <button onclick="closeApiModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-light);">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="api-grid">
                <!-- Google Calendar API Card -->
                <div class="api-card" onclick="addApi('google-calendar')">
                    <div class="api-card-icon" style="background: linear-gradient(135deg, #4285f4 0%, #34a853 100%);">
                        <i class="fab fa-google"></i>
                    </div>
                    <h3>Google Calendar</h3>
                    <p>Termine erstellen, verwalten und abrufen</p>
                    <div class="api-card-badge">
                        <i class="fas fa-check-circle"></i> Verf√ºgbar
                    </div>
                </div>

                <!-- Outlook Calendar API Card -->
                <div class="api-card" onclick="addApi('outlook-calendar')">
                    <div class="api-card-icon" style="background: linear-gradient(135deg, #0078d4 0%, #106ebe 100%);">
                        <i class="fab fa-microsoft"></i>
                    </div>
                    <h3>Outlook Calendar</h3>
                    <p>Microsoft 365 Kalenderintegration</p>
                    <div class="api-card-badge">
                        <i class="fas fa-check-circle"></i> Verf√ºgbar
                    </div>
                </div>

                <!-- Weitere APIs (Platzhalter) -->
                <div class="api-card disabled">
                    <div class="api-card-icon" style="background: linear-gradient(135deg, #00a67e 0%, #008c6c 100%);">
                        <i class="fas fa-envelope"></i>
                    </div>
                    <h3>SendGrid (E-Mail)</h3>
                    <p>E-Mails versenden</p>
                    <div class="api-card-badge" style="background-color: #94a3b8; color: white;">
                        <i class="fas fa-clock"></i> Bald verf√ºgbar
                    </div>
                </div>

                <div class="api-card disabled">
                    <div class="api-card-icon" style="background: linear-gradient(135deg, #1da1f2 0%, #0c85d0 100%);">
                        <i class="fab fa-twitter"></i>
                    </div>
                    <h3>Twitter API</h3>
                    <p>Tweets posten und lesen</p>
                    <div class="api-card-badge" style="background-color: #94a3b8; color: white;">
                        <i class="fas fa-clock"></i> Bald verf√ºgbar
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Basic JavaScript functionality
        function saveApiKey() {
            const key = document.getElementById("apiKeyInput").value;
            if (key && key.trim().length > 0) {
                localStorage.setItem("mistral_api_key", key);
                alert("Mistral AI API-Key gespeichert ‚úÖ");
            } else {
                alert("Ung√ºltiger API-Key!");
            }
        }

        function switchTab(botType, tabName) {
            // Tab switching logic would go here
            console.log(`Switching to ${tabName} tab for ${botType}`);
        }

        function closeModal() {
            document.getElementById('createBotModal').classList.remove('active');
        }

        // Page navigation
        document.querySelectorAll('.nav-links li').forEach(item => {
            item.addEventListener('click', function() {
                const page = this.getAttribute('data-page');
                
                // Update active nav
                document.querySelectorAll('.nav-links li').forEach(li => li.classList.remove('active'));
                this.classList.add('active');
                
                // Update active page
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                const targetPage = document.getElementById(page);
                if (targetPage) {
                    targetPage.classList.add('active');
                }
            });
        });

        // Google API Check
        let googleApiCheckInterval;
        let googleApiLoaded = false;
        
        function checkGoogleAPIs() {
            if (typeof gapi !== 'undefined' && typeof google !== 'undefined' && google.accounts) {
                googleApiLoaded = true;
                console.log('‚úÖ Google APIs erfolgreich geladen!');
                if (googleApiCheckInterval) {
                    clearInterval(googleApiCheckInterval);
                }
            }
        }
        
        googleApiCheckInterval = setInterval(checkGoogleAPIs, 500);
        
        setTimeout(() => {
            if (!googleApiLoaded) {
                console.warn('‚ö†Ô∏è Google APIs konnten nicht geladen werden.');
                clearInterval(googleApiCheckInterval);
            }
        }, 10000);
    </script>
    
    <!-- Main Application Logic -->
    <script src="app.js"></script>
</body>